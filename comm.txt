sudo apt update
sudo apt install network-manager -y
sudo systemctl enable NetworkManager
sudo systemctl start NetworkManager

# Create hotspot profile
sudo nmcli con add con-name BoatHotspot ifname wlan0 type wifi ssid "BoatController"
sudo nmcli con modify BoatHotspot wifi-sec.key-mgmt wpa-psk
sudo nmcli con modify BoatHotspot wifi-sec.psk "remote1234"
sudo nmcli con modify BoatHotspot 802-11-wireless.mode ap
sudo nmcli con modify BoatHotspot 802-11-wireless.band bg
sudo nmcli con modify BoatHotspot ipv4.method shared

# Set highest autoconnect priority
sudo nmcli con modify BoatHotspot connection.autoconnect yes
sudo nmcli con modify BoatHotspot connection.autoconnect-priority 0

# Enable and start hotspot
sudo nmcli con up BoatHotspot


nmcli dev wifi list
# Should show BoatController as an access point

# In bridge.py
UDP_IP = '0.0.0.0'  # Listen on all interfaces
UDP_PORT = 12345

# No changes needed to ESP32 code


ESP32_IP = "192.168.50.1"  # Network Manager's default AP gateway
PORT = 12345

sudo nano /etc/systemd/system/boat-system.service


[Unit]
Description=Boat Control System
After=network.target

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/bin/nmcli con up BoatHotspot
ExecStart=/usr/local/bin/start_stream.sh
ExecStart=/usr/bin/python3 /home/pi/bridge.py

[Install]
WantedBy=multi-user.target

sudo systemctl daemon-reload
sudo systemctl enable boat-system

sudo nano /etc/udev/rules.d/99-uart.rules

KERNEL=="ttyAMA0", GROUP="dialout", MODE="0660"
KERNEL=="ttyS0", GROUP="dialout", MODE="0660"


sudo udevadm control --reload-rules
sudo udevadm trigger

systemctl status boat-system